(this["webpackJsonpreact-socketio-app"]=this["webpackJsonpreact-socketio-app"]||[]).push([[0],{198:function(e,t,n){},213:function(e,t,n){e.exports=n(403)},218:function(e,t,n){},219:function(e,t,n){},220:function(e,t,n){},322:function(e,t,n){},323:function(e,t,n){},331:function(e,t,n){},332:function(e,t,n){},333:function(e,t,n){},334:function(e,t,n){},335:function(e,t,n){},336:function(e,t,n){},350:function(e,t,n){},351:function(e,t,n){},352:function(e,t,n){},353:function(e,t,n){},354:function(e,t,n){},382:function(e,t){},403:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(35),s=n.n(r),c=n(201),l=(n(218),n(219),n(7)),i=n(420),u=(n(220),function(e){var t=e.activeTab,n=e.setActiveTab,a=function(e,t){var a=t.name;n(a)};return o.a.createElement(i.a,{inverted:!0},o.a.createElement(i.a.Item,{name:"logout",active:"logout"===t,onClick:a}),o.a.createElement(i.a.Item,{name:"your-rooms",active:"your rooms"===t,onClick:a}),o.a.createElement(i.a.Item,{name:"private-chats",active:"private chats"===t,onClick:a}),o.a.createElement(i.a.Item,{name:"notifications",active:"notifications"===t,onClick:a}),o.a.createElement(i.a.Item,{name:"dashboard",active:"dashboard"===t,onClick:a}))}),m=(n(322),n(323),n(416)),d=function(e){var t=e.joinRequestsPending;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"req-list_wrapper"},t&&o.a.createElement("h3",null,"Join Requests Pending:"),o.a.createElement(m.a,{divided:!0,verticalAlign:"middle"},t&&t.map((function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a.Item,{key:e.id},o.a.createElement(m.a.Content,{floated:"left"},e," ")))})))))},f=(n(331),function(e){var t=e.joinRequestsApproved;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"req-list_wrapper"},t&&o.a.createElement("h3",null,"Approved requests:"),o.a.createElement(m.a,{divided:!0,verticalAlign:"middle"},t&&t.map((function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a.Item,{key:e.id},o.a.createElement(m.a.Content,{floated:"left"},e," ")))})))))}),g=function(e){var t=e.joinRequestsPending,n=e.joinRequestsApproved;return o.a.createElement("div",{className:"searchContainer"},o.a.createElement(d,{joinRequestsPending:t}),o.a.createElement(f,{joinRequestsApproved:n}))},v=n(404),b=n(202),p=(n(332),function(e){var t=e.joinRequests,n=e.confirmJoinRequest;return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{divided:!0,verticalAlign:"middle",className:"notificationsList"},t&&t.map((function(e){return o.a.createElement(m.a.Item,{key:e.id},o.a.createElement(m.a.Content,{floated:"right",className:"confirm"},o.a.createElement(v.a,{className:"acceptButton",onClick:function(){return n(e)}},"Confirm Request")),o.a.createElement(b.a,{floated:"left",avatar:!0,src:"https://react.semantic-ui.com/images/avatar/small/lindsay.png"}),o.a.createElement(m.a.Content,{floated:"left"},e.name," send a join request for room: ",e.requested_room))}))))}),E=function(e){var t=e.joinRequestsReceived,n=e.confirmJoinRequest;return console.log("[Notifications], joinRequestReceived: ",t),o.a.createElement(p,{joinRequests:t,confirmJoinRequest:n})},j=function(e){var t=e.roomNames,n=e.currentRoom,a=e.setCurrentRoom,r=function(e,t){var n=t.name;return a(n)};return console.log("active item: ",n),o.a.createElement(i.a,{fluid:!0,vertical:!0,tabular:!0},t.map((function(e){return o.a.createElement(i.a.Item,{name:e,key:e,active:n===e,onClick:r})})),o.a.createElement(i.a.Item,{name:"create room",active:"create room"===n,onClick:r}),o.a.createElement(i.a.Item,{name:"join new room",active:"join new room"===n,onClick:r}))},R=(n(333),n(412)),h=(n(334),function(e){var t=e.onSendMessage,n=Object(a.useState)(""),r=Object(l.a)(n,2),s=r[0],c=r[1],i=function(){c(""),console.log("sending message from MessageInput: ",s),t(s)};return o.a.createElement(R.a,{className:"messageInput",action:{content:"Send",onClick:i},value:s,placeholder:"Type message...",onChange:function(e,t){var n,a=t.value;return n=a,void c((function(){return n}))},onKeyUp:function(e){13===e.keyCode&&i()}})}),O=(n(335),function(e){var t=e.activeRoom,n=e.messages,r=Object(a.useRef)(null);return Object(a.useEffect)((function(){r.current.scrollIntoView({behavior:"smooth"})}),[n]),o.a.createElement("div",null,o.a.createElement(m.a,{divided:!0,relaxed:!0},n&&n.length?n.sort((function(e,t){return e.date-t.date})).map((function(e,n){e.date,e.messageid;var a=e.messagetext,r=(e.roomname,e.username);return o.a.createElement(m.a.Item,null,o.a.createElement(m.a.Content,{key:n},o.a.createElement(m.a.Header,null,"Room ",t,", User name: ",r),o.a.createElement(m.a.Description,null,a)))})):o.a.createElement("div",null,"No messages in ",t," yet!"),o.a.createElement("div",{ref:r})))}),S=n(421),q=n(413),C=(n(336),function(e){var t=e.sendCreatedNewRoom,n=Object(a.useState)(""),r=Object(l.a)(n,2),s=r[0],c=r[1],i=Object(a.useState)(""),u=Object(l.a)(i,2),m=(u[0],u[1]),d=Object(a.useState)(!1),f=Object(l.a)(d,2),g=f[0],b=f[1];return o.a.createElement(S.a,{inverted:!0},o.a.createElement(q.a,{inverted:!0,className:"new-room_form"},o.a.createElement(q.a.Group,{widths:"equal"},o.a.createElement(q.a.Input,{fluid:!0,label:"room name",placeholder:"room name",onChange:function(e){c(e.target.value)},value:s}),o.a.createElement(q.a.TextArea,{fluid:!0,label:"description",placeholder:"description",onChange:function(e){m(e.target.value)}})),o.a.createElement(q.a.Checkbox,{label:"Allow users to join without approval",onClick:function(e){b((function(e){return!e}))}}),o.a.createElement(v.a,{type:"submit",onClick:function(e){t({roomName:s,authorise:g})}},"Submit")))}),M=function(e){var t=e.sendCreatedNewRoom;return o.a.createElement("div",null,o.a.createElement(C,{sendCreatedNewRoom:t}))},N=n(197),P=n.n(N),w=n(417),k=n(415),y=(n(350),function(e){var t=e.availableRooms,n=e.onJoinRoomsRequest,r=e.joinRequestSent,s=e.setJoinRequestSent,c=function(){return t.map((function(e){return{key:e,text:e,value:P.a.snakeCase(e)}}))},i=Object(a.useState)([]),u=Object(l.a)(i,2),m=u[0],d=u[1],f=Object(a.useState)(c()),g=Object(l.a)(f,2),b=g[0],p=g[1],E=Object(a.useState)(!0),j=Object(l.a)(E,2),R=j[0],h=j[1],O=function(){s(!1),h(!1),p(c)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(w.a,{size:"mini",open:R,onClose:O},o.a.createElement(w.a.Header,null,"Join Request Successful!"),o.a.createElement(w.a.Content,null,o.a.createElement("p",null,"You have requested to join the following rooms: "),r&&r.requestedRooms.map((function(e){return o.a.createElement("p",null,e)})),o.a.createElement("p",null,"You'll be notified once the room admin accepts your request.")),o.a.createElement(w.a.Actions,null,o.a.createElement(v.a,{positive:!0,onClick:O},"Ok"))),o.a.createElement("div",{className:"roomSearch"},o.a.createElement("div",null,o.a.createElement(k.a,{fluid:!0,selection:!0,multiple:!0,search:!0,options:b,value:m,placeholder:"Select rooms",onChange:function(e,t){var n=t.value;return d(n)},disabled:!1,loading:!1})),o.a.createElement("div",{className:"buttonWrapper"},o.a.createElement(v.a,{fluid:!0,className:"joinButton",disabled:!m.length,onClick:function(){n(m),d([])}},m.length?"Request To Join Selected Rooms":"Select rooms you wish to join"))))}),U=function(e){var t=e.currentRoom,n=e.getMessages,a=e.onSendMessage,r=e.onSendCreatedNewRoom,s=e.availableRooms,c=e.onJoinRoomsRequest,l=e.joinRequestSent,i=e.setJoinRequestSent;console.log(t);return o.a.createElement("div",{className:"chat-room_container"},function(){switch(t){case"create room":return o.a.createElement(M,{sendCreatedNewRoom:r});case"join new room":return o.a.createElement(y,{availableRooms:s,onJoinRoomsRequest:c,joinRequestSent:l,setJoinRequestSent:i});default:return o.a.createElement(o.a.Fragment,null,o.a.createElement(O,{currentRoom:t,messages:n(t)}),o.a.createElement(h,{onSendMessage:a(t)}))}}())},J=n(422),A=function(e){var t=e.roomNames,n=e.rooms,r=e.onMessageReceived,s=e.onSendMessage,c=e.onSendCreatedNewRoom,i=e.availableRooms,u=e.onJoinRoomsRequest,m=e.joinRequestSent,d=e.setJoinRequestSent,f=Object(a.useState)(null),g=Object(l.a)(f,2),v=g[0],b=g[1];return Object(a.useEffect)((function(){n&&t&&!v&&b(t[0])}),[n,t]),v&&"create"!==v&&o.a.createElement(J.a,null,o.a.createElement(J.a.Column,{width:4},v&&o.a.createElement(j,{roomNames:t,currentRoom:v,setCurrentRoom:b})),o.a.createElement(J.a.Column,{stretched:!0,width:12},o.a.createElement(S.a,null,n&&o.a.createElement(U,{currentRoom:v,getMessages:r,onSendMessage:s,onSendCreatedNewRoom:c,availableRooms:i,onJoinRoomsRequest:u,joinRequestSent:m,setJoinRequestSent:d}))))},I=function(e){var t=e.PMuserNames,n=e.activeTab,a=e.PMsetActiveChat;console.log("in RoomList, PMuserNames: ",t);var r=function(e,t){var n=t.name;return a(n)};return console.log("active item: ",n),o.a.createElement(i.a,{fluid:!0,vertical:!0,tabular:!0},t.map((function(e){return o.a.createElement(i.a.Item,{name:e,key:e,active:n===e,onClick:r})})),o.a.createElement(i.a.Item,{name:"find user",active:"find user"===n,onClick:r}))},x=n(418),T=n(26),F=(n(351),function(e){var t=e.filteredUsers,n=e.onSendPrivateMessage,r=Object(a.useState)(0),s=Object(l.a)(r,2),c=s[0],i=s[1],u=Object(a.useState)(""),m=Object(l.a)(u,2),d=m[0],f=m[1],g=function(e,t){var n=t.index;i(c===n?-1:n)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,{className:"users-search"},!t.length&&o.a.createElement("p",null,"No results to show!"),t&&t.map((function(e,t){return o.a.createElement(x.a,null,o.a.createElement(x.a.Title,{active:c===t,index:t,onClick:g},o.a.createElement(T.a,{name:"dropdown"}),e),o.a.createElement(x.a.Content,{active:c===t},o.a.createElement(R.a,{className:"findAndMessageInput",onChange:function(e){return f(e.target.value)},placeholder:"Message ".concat(e)},o.a.createElement("input",null),o.a.createElement(v.a,{type:"submit",onClick:function(t){return n(e)(d)}},"Send Message"))))}))))}),_=function(e){var t=e.onSendPrivateMessage,n=e.availableUsers,r=Object(a.useState)(n),s=Object(l.a)(r,2),c=s[0],i=s[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a,{className:"mainSearch",label:"Find User",placeholder:"Search...",onChange:function(e){var t=e.target.value;console.log("search query: ",t),t||i(n);var a=n.filter((function(e){return e.includes(t)}));i(a),console.log(t)}}),o.a.createElement(F,{onSendPrivateMessage:t,filteredUsers:c}))},D=(n(352),n(353),function(e){var t=e.onSendPrivateMessage,n=Object(a.useState)(""),r=Object(l.a)(n,2),s=r[0],c=r[1],i=function(){c(""),console.log("sending message from MessageInput: ",s),t(s)};return o.a.createElement(R.a,{className:"messageInput",action:{content:"Send",onClick:i},value:s,placeholder:"Type message...",onChange:function(e,t){var n,a=t.value;return n=a,void c((function(){return n}))},onKeyUp:function(e){13===e.keyCode&&i()}})}),L=(n(354),function(e){e.activeRoom;var t=e.messages,n=Object(a.useRef)(null);return Object(a.useEffect)((function(){n.current.scrollIntoView({behavior:"smooth"})}),[t]),o.a.createElement("div",null,o.a.createElement(m.a,{divided:!0,relaxed:!0},o.a.createElement(m.a.Item,null,o.a.createElement(m.a.Content,null,o.a.createElement(m.a.Header,null,"Dummy user name"),o.a.createElement(m.a.Description,null,"Dummy message"))),t.sort((function(e,t){return e.date-t.date})).map((function(e,t){e.messageid;var n=e.senderName,a=e.receipientName,r=e.message;return e.date,o.a.createElement(m.a.Item,null,o.a.createElement(m.a.Content,{key:t},o.a.createElement(m.a.Header,null,"Receiver ",a,", Sender: ",n),o.a.createElement(m.a.Description,null,r)))})),o.a.createElement("div",{ref:n})))}),B=function(e){var t=e.activeRoom,n=e.messages,a=e.onSendPrivateMessage;return console.log(t),console.log("[CurrentChat] messages: ",n),o.a.createElement("div",{className:"chat-room_container"},o.a.createElement(L,{activeRoom:t,messages:n}),o.a.createElement(D,{onSendPrivateMessage:a}))},H=function(e){var t=e.PMuserNames,n=e.PMessages,r=e.onPrivateMessageReceived,s=e.onSendPrivateMessage,c=e.availableUsers,i=Object(a.useState)(t[0]),u=Object(l.a)(i,2),m=u[0],d=u[1];return console.log("[PrivateChat] PMchats[username].messages: ",n[t[0]].messages),console.log("[PrivateChat] PMuserNames: ",t),console.log("[PrivateChat] PMactiveChat: ",m),o.a.createElement(J.a,null,o.a.createElement(J.a.Column,{width:4},m&&o.a.createElement(I,{PMuserNames:t,activeTab:m,PMsetActiveChat:d})),o.a.createElement(J.a.Column,{stretched:!0,width:12},o.a.createElement(S.a,null,"find user"===m&&o.a.createElement(_,{onSendPrivateMessage:s,availableUsers:c}),n&&"find user"!==m&&o.a.createElement(B,{PMactiveChat:m,messages:r(m),onSendPrivateMessage:s(m)}))))},W=function(e){var t=e.onSendMessage,n=e.onMessageReceived,r=e.onJoinRoomsRequest,s=e.joinRequestSent,c=e.setJoinRequestSent,i=e.joinRequestsApproved,m=e.rooms,d=e.roomNames,f=e.joinRequestsReceived,v=e.joinRequestsPending,b=e.onLogout,p=e.availableRooms,j=e.availableUsers,R=e.confirmJoinRequest,h=e.onPrivateMessageReceived,O=e.PMuserNames,S=e.PMessages,q=e.onSendPrivateMessage,C=e.onSendCreatedNewRoom,M=Object(a.useState)(m?"messages":"dashboard"),N=Object(l.a)(M,2),P=N[0],w=N[1];console.log("[MainApp] PMessages: "),console.dir(S);var k={availableRooms:p,availableUsers:j,onSendPrivateMessage:q,onJoinRoomsRequest:r,joinRequestsPending:v,joinRequestsApproved:i,joinRequestSent:s,setJoinRequestSent:c},y={availableRooms:p,onJoinRoomsRequest:r,joinRequestSent:s,setJoinRequestSent:c},U={roomNames:d,rooms:m,onMessageReceived:n,onSendMessage:t,onSendCreatedNewRoom:C},J={PMuserNames:O,PMessages:S,onPrivateMessageReceived:h,onSendPrivateMessage:q,availableUsers:j},I={joinRequestsReceived:f,confirmJoinRequest:R};return o.a.createElement("div",{className:"container"},o.a.createElement(u,{onLogout:b,activeTab:P,setActiveTab:w}),function(e){switch(e){case"logout":return b();case"your-rooms":return m?o.a.createElement(A,Object.assign({},U,y)):null;case"private-chats":return S?o.a.createElement(H,J):null;case"dashboard":return p&&j?o.a.createElement(g,k):null;case"notifications":return o.a.createElement(E,I);default:return p&&j?o.a.createElement(g,k):null}}(P))},G=n(203),Y=n(419),z=function(e){var t=e.message,n=Object(G.a)(e,["message"]);return o.a.createElement(Y.a,n,o.a.createElement(Y.a.Header,null,t.title),o.a.createElement("p",null,t.text))},K=n(198),V=function(e){var t=e.authenticateUser,n=e.signupNewUser,r=e.userUnauthorised,s=Object(a.useState)(""),c=Object(l.a)(s,2),i=c[0],u=c[1],m=Object(a.useState)(""),d=Object(l.a)(m,2),f=d[0],g=d[1],v=Object(a.useState)(""),b=Object(l.a)(v,2),p=b[0],E=b[1],j=Object(a.useState)(!1),R=Object(l.a)(j,2),h=R[0],O=R[1],S=Object(a.useState)(!1),C=Object(l.a)(S,2),M=C[0],N=C[1],P=Object(a.useState)(!1),w=Object(l.a)(P,2),k=w[0],y=w[1],U=Object(a.useState)(!1),A=Object(l.a)(U,2),I=A[0],x=A[1],T=Object(a.useState)(!1),F=Object(l.a)(T,2),_=F[0],D=F[1],L=Object(a.useState)(!1),B=Object(l.a)(L,2),H=B[0],W=B[1],G=Object(a.useState)(!1),Y=Object(l.a)(G,2),V=Y[0],$=Y[1];Object(a.useEffect)((function(){$(r)}),[r]);var Q=function(e){W(!1),$(!1);var t=e.target.value;u(t),y(!t)},X=function(e){var t=e.target.value;g(t),!t||t.length<5||t.length>20?x(!0):x(!1)},Z=function(e){var t=e.target.value;E(t),D(!t||f!==t)},ee=function(){u(""),g(""),E("")};return o.a.createElement("div",null,o.a.createElement(J.a,{centered:!0},o.a.createElement(q.a,null,function(){var e={negative:!0};return k?e.message={title:"Username required!",text:"Please provide a valid name."}:I?e.message={title:"Password required!",text:"Please provide a valid password."}:_?e.message={title:"Password confirmation required!",text:"Please confirm your password."}:H?e.message={title:"Username ".concat(H," already exists!"),text:"Please use different name"}:V&&(e.message={title:"Wrong username or password!",text:"Please sign in with valid name and password"}),k||I||_||V||H?o.a.createElement(z,e):null}(),M&&function(){var e={color:"green",message:{title:"You have successfully signed up!",text:"Please log in to continue."}};return o.a.createElement(z,e)}(),h?o.a.createElement(q.a.Group,{widths:"equal"},o.a.createElement(q.a.Field,{id:"username"},o.a.createElement("label",{style:{textAlign:"left"}},"User Name"),o.a.createElement("input",{placeholder:"User Name",value:i,onChange:Q,error:{content:"Please enter User Name",pointing:"below"}})),o.a.createElement(q.a.Field,{id:"password"},o.a.createElement("label",{style:{textAlign:"left"}},"Password"),o.a.createElement("input",{placeholder:"Password",value:f,onChange:X,error:{content:"Please enter a valid password",pointing:"below"}})),o.a.createElement(q.a.Field,{id:"passwordConfirm"},o.a.createElement("label",{style:{textAlign:"left"}},"Confirm Password"),o.a.createElement("input",{placeholder:"Password",value:p,onChange:Z,error:{content:"Paswords need to match!",pointing:"below"}}))):o.a.createElement(q.a.Group,{widths:"equal"},o.a.createElement(q.a.Field,null,o.a.createElement("label",{style:{textAlign:"left"}},"User Name"),o.a.createElement("input",{placeholder:"User Name",value:i,onChange:Q})),o.a.createElement(q.a.Field,null,o.a.createElement("label",{style:{textAlign:"left"}},"Password"),o.a.createElement("input",{placeholder:"Password",value:f,onChange:X}))),o.a.createElement("div",{className:"buttons"},o.a.createElement(q.a.Button,{onClick:function(){ee(),y(!1),x(!1),D(!1),W(!1),W(!1),O((function(e){return e.isSignupMode||N(!1),!e}))}},h?"Already a user, log me in!":"Not yet a user, sign me up!"),o.a.createElement(q.a.Button,{type:"submit",className:K.login_button,onClick:h?function(){i&&f===p&&h&&(console.log("[Login@sendSignup]"),n(i,f).then((function(e){console.log("response satatus: ",e.status),console.log("POST request result ",e),console.log("response from server: ",e.data),201===e.status&&(console.log("received response 201"),N(!0),O(!1)),ee()})).catch((function(e){W(i),ee(),console.log("POST request error: ",e)})))}:function(){ee(),t(i,f)},disabled:h?!i||!f||f.length<5||f.length>20||f!==p:!i||!f||f.length<5||f.length>20},h?"Sign Up":"Login")))))},$=n(49),Q=n(19),X=n(50),Z=n(199),ee=n.n(Z),te=n(119),ne=n.n(te),ae=function(){var e=Object(a.useRef)(),t=Object(a.useState)(null),n=Object(l.a)(t,2),o=n[0],r=n[1],s=Object(a.useState)(null),c=Object(l.a)(s,2),i=c[0],u=c[1],m=Object(a.useState)(!1),d=Object(l.a)(m,2),f=d[0],g=d[1],v=Object(a.useState)(!1),b=Object(l.a)(v,2),p=b[0],E=b[1],j=Object(a.useState)(!1),R=Object(l.a)(j,2),h=R[0],O=R[1],S=Object(a.useState)(null),q=Object(l.a)(S,2),C=q[0],M=q[1],N=Object(a.useState)([]),P=Object(l.a)(N,2),w=P[0],k=P[1],y=Object(a.useState)(null),U=Object(l.a)(y,2),J=U[0],A=U[1],I=Object(a.useState)(null),x=Object(l.a)(I,2),T=x[0],F=x[1],_=Object(a.useState)(null),D=Object(l.a)(_,2),L=D[0],B=D[1],H=Object(a.useState)([]),W=Object(l.a)(H,2),G=W[0],Y=W[1],z=Object(a.useState)([]),K=Object(l.a)(z,2),V=K[0],Z=K[1],te=Object(a.useState)([]),ae=Object(l.a)(te,2),oe=ae[0],re=ae[1],se=Object(a.useState)(null),ce=Object(l.a)(se,2),le=ce[0],ie=ce[1],ue=Object(a.useState)(!1),me=Object(l.a)(ue,2),de=(me[0],me[1]),fe=Object(a.useState)(null),ge=Object(l.a)(fe,2),ve=ge[0],be=ge[1];Object(a.useEffect)((function(){if(o&&i)return e.current=ee()("http://localhost:3001"),e.current.on("connect",(function(){console.log("Socket connected: ",e.current.socket),e.current.emit("authentication",{username:o,password:i})})),e.current.on("unauthorized",(function(){E(!0),g(!1),r(null),u(null)})),e.current.on("authenticated",(function(){g(!0),je(),de(!0),e.current.on("joined rooms",(function(e){k(e),console.log("roomsNames in useEffect: ",e)})),e.current.on("past messages",(function(e){M(e)})),e.current.on("past private messages",(function(e){ie(e)})),e.current.on("available rooms",(function(e){g(!0),A(e)})),e.current.on("join room requests to approve",(function(e){be(e)})),e.current.on("join requests pending approval",(function(e){Y(e)})),e.current.on("join requests approved",(function(e){Z(e)})),e.current.on("available users",(function(e){F(e)})),e.current.on("new room created",(function(e){pe(e)}))})),function(){e.current.disconnect()}}),[o,i]),Object(a.useEffect)((function(){if(C&&!h)return Ee(),void O(!0)}),[C,w,h]),Object(a.useEffect)((function(){if(le){var e=Object.keys(le);re(Object(X.a)(e))}}),[le]);var pe=function(e){M((function(t){return Object(Q.a)(Object(Q.a)({},t),{},{newRoom:e})})),k((function(t){return[].concat(Object(X.a)(t),[e.roomName])}))},Ee=function(){console.log("setRoomEvents outer fn, rooms: "),console.dir(C),w.forEach((function(t){console.log("setting event for room: ".concat(t)),e.current.on("message for ".concat(t),(function(e){var n=e.message;console.log("event received: 'message for ' ".concat(t,", message: ").concat(n)),console.log("chats: "),console.dir(C),Re(t,n,!1)}))}))},je=function(){console.log("[setPMEventsListeners] setting private message events"),e.current.on("private message",(function(e){Re(e.receipientName,e,!0),console.log("received private message for: ' ".concat(e.receipientName,", message: ").concat(e.messagetext))}))},Re=function(e,t,n){console.log("[addMessageToChat] chatName: ".concat(e,", message: ")),console.dir(t),console.log("addMessageToChat: rooms: ".concat(C)),n?ie((function(n){return he(n,e,t)})):M((function(n){return he(n,e,t)}))},he=function(e,t,n,a){if(!e||!e[t]){var o=[n];return Object(Q.a)(Object(Q.a)({},e),{},Object($.a)({},t,{messages:o}))}var r=e[t].messages,s=Object(X.a)(r);console.log("[addMessageToChat] oldMessages",r),s.push(n),console.log("[addMessageToChat] updateMessages",s);var c=Object(Q.a)(Object(Q.a)({},e[t]),{},{messages:s});console.log("updatedRoom: ",c);var l=Object(Q.a)(Object(Q.a)({},e),{},Object($.a)({},t,c));return console.log("updatedRooms: ",l),Object(Q.a)(Object(Q.a)({},e),{},Object($.a)({},t,c))};return{authenticateUser:function(e,t){r(e),u(t)},signupNewUser:function(e,t){var n={username:e,password:t};return ne()({method:"post",url:"http://localhost:3001/signup",headers:{"Content-Type":"application/json"},data:n})},logoutUser:function(){return g(!1),r(null),u(null),M(null),k(null),O(null),e.current.disconnect()},userAuthenticated:f,userUnauthorised:p,roomNames:w,rooms:C,availableRooms:J,availableUsers:T,joinRequestSent:L,joinRequestsToApprove:ve,joinRequestsPending:G,joinRequestsApproved:V,confirmJoinRequest:function(t){e.current.emit("confirm join request",t),be((function(e){var n=e.filter((function(e){return e.id!==t.id}));return Object(X.a)(n)}))},setJoinRequestSent:B,sendJoinRequest:function(e){var t={rooms:e,username:o};return ne()({method:"post",url:"http://localhost:3001/joinRooms",headers:{"Content-Type":"application/json"},data:t}).then((function(t){200===t.status&&(B({requestedRooms:e}),A((function(t){var n=t.filter((function(t){return!e.includes(t)}));return console.log("[_useSocket], updatedAvailableRooms",n),Object(X.a)(n)})))}))},getMessagesForRoom:function(e){if(console.log("[getMessagesForRoom], roomName: ",e),C[e])return C[e].messages},sendMessage:function(t){var n=new Date;return function(a){console.log("[sendMessage@_useSocket], roomName: ",t);var r={date:Date.parse(n)/1e3,messagetext:a,roomname:t,username:o};e.current.emit("message for ".concat(t),{message:r})}},getPrivateMessagesFromUser:function(e){if(le)return le[e].messages},sendCreateNewRoom:function(t){t.creatorName=o,e.current.emit("create new room",t)},PMUserNames:oe,PMessages:le,sendPM:function(t){return console.log("[_useSocket] sendPM receipientName: ".concat(t)),function(n){var a=new Date;console.log("[_useSocket] inner fn sendPM, roomName: ",t);var r={date:Date.parse(a)/1e3,message:n,receipientName:t,senderName:o};e.current.emit("private message",r)}}}},oe=function(e){var t=ae(),n=t.signupNewUser,a=t.authenticateUser,r=t.logoutUser,s=t.userAuthenticated,c=t.userUnauthorised,l=t.roomNames,i=t.rooms,u=t.availableRooms,m=t.availableUsers,d=t.joinRequestSent,f=t.joinRoomsSuccess,g=t.joinRequestsToApprove,v=t.joinRequestsPending,b=t.joinRequestsApproved,p=t.sendCreateNewRoom,E=t.confirmJoinRequest,j=t.setJoinRequestSent,R=t.sendJoinRequest,h=t.getMessagesForRoom,O=t.sendMessage,S=t.getPrivateMessagesFromUser,q=t.PMUserNames,C=t.PMessages,M=t.sendPM,N={availableRooms:u,availableUsers:m,joinRequestSent:d,rooms:i,roomNames:l,joinRequestsReceived:g,joinRoomsSuccess:f,joinRequestsApproved:b,joinRequestsPending:v,setJoinRequestSent:function(){return j()},onSendMessage:function(e){return O(e)},onMessageReceived:function(e){return h(e)},onSendCreatedNewRoom:function(e){return p(e)},PMuserNames:q,PMessages:C,onPrivateMessageReceived:function(e){return S(e)},onSendPrivateMessage:function(e,t){return M(e,t)},onJoinRoomsRequest:function(e){return R(e)},confirmJoinRequest:E,onLogout:function(){r()}};return o.a.createElement("div",null,s?null:o.a.createElement(V,{authenticateUser:function(e,t){a(e,t)},signupNewUser:n,userUnauthorised:c}),s&&o.a.createElement(W,N))};var re=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(oe,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(401);s.a.render(o.a.createElement(c.a,null,o.a.createElement(re,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[213,1,2]]]);
//# sourceMappingURL=main.dac9e7cd.chunk.js.map